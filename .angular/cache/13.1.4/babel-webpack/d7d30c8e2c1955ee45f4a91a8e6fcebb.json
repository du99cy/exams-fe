{"ast":null,"code":"import { environment } from '@environment/environment';\nexport function appInitializer(authService) {\n  return () => new Promise(resolve => {\n    // wait for facebook sdk to initialize before starting the angular app\n    window['fbAsyncInit'] = function () {\n      FB.init({\n        appId: environment.facebookAppId,\n        cookie: true,\n        xfbml: true,\n        version: 'v8.0'\n      }); // auto authenticate with the api if already logged in with facebook\n\n      FB.getLoginStatus(({\n        authResponse\n      }) => {\n        //if previous facebook login then auto login with facebook access token\n        if (authResponse) {\n          authService.apiAuthenticateFB(authResponse.accessToken).subscribe(res => {\n            resolve(null);\n          });\n        } else {\n          //else check previous mail login then check access token that saved in local storage\n          //get access token from localStorage\n          let accessToken = authService.getAccesTokenFromLocalStorage(); //if not null get refresh token and get user infor\n\n          if (accessToken) {\n            //get new token\n            authService.refreshToken().subscribe(res => {\n              //get user information\n              authService.userInfor().subscribe(() => {\n                resolve(null);\n              });\n            });\n          }\n        }\n      });\n    }; // load facebook sdk script\n\n\n    (function (d, s, id) {\n      var js,\n          fjs = d.getElementsByTagName(s)[0];\n\n      if (d.getElementById(id)) {\n        return;\n      }\n\n      js = d.createElement(s);\n      js.id = id;\n      js.src = 'https://connect.facebook.net/en_US/sdk.js';\n      fjs.parentNode.insertBefore(js, fjs);\n    })(document, 'script', 'facebook-jssdk');\n  });\n}","map":null,"metadata":{},"sourceType":"module"}